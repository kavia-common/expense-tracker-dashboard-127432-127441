{"is_source_file": true, "format": "JavaScript", "description": "This file defines an authentication service (`AuthService`) for handling user login via magic links, JWT token generation and verification, and email notifications. It interacts with a database module for storing and retrieving magic links and user data, and uses environment variables for configuration.", "external_files": ["./database"], "external_methods": ["database.run", "database.get", "jwt.sign", "jwt.verify"], "published": ["generateMagicLink", "verifyMagicLink", "generateJWT", "verifyJWT"], "classes": [{"name": "AuthService", "description": "A service class responsible for handling authentication processes including magic link generation, verification, JWT handling, and email sending."}], "methods": [{"name": "createEmailTransporter()", "description": "Sets up the email transporter for sending magic link emails, falling back to console logging if email configuration is missing.", "scope": "AuthService", "scopeKind": "class"}, {"name": "generateMagicLink(email)", "description": "Creates a secure magic link token, stores it in the database, and sends the link via email or logs it to the console in development mode.", "scope": "AuthService", "scopeKind": "class"}, {"name": "verifyMagicLink(token)", "description": "Validates a magic link token, marks it as used, creates or retrieves a user, and generates a JWT token upon successful verification.", "scope": "AuthService", "scopeKind": "class"}, {"name": "generateJWT(user)", "description": "Generates a signed JWT token for an authenticated user, with configurable expiration.", "scope": "AuthService", "scopeKind": "class"}, {"name": "verifyJWT(token)", "description": "Verifies a given JWT token and decodes its payload, throwing an error if invalid or expired.", "scope": "AuthService", "scopeKind": "class"}, {"name": "sendMagicLinkEmail(email, magicLinkUrl)", "description": "Composes and sends an email containing the magic link; logs to console if email transporter is not configured.", "scope": "AuthService", "scopeKind": "class"}, {"name": "logMagicLinkToConsole(email, magicLinkUrl)", "description": "Outputs the magic link email content to the console in development mode.", "scope": "AuthService", "scopeKind": "class"}, {"name": "constructor()", "scope": "AuthService", "scopeKind": "class", "description": "unavailable"}], "calls": ["database.run", "database.get", "jwt.sign", "jwt.verify"], "search-terms": ["AuthService", "magic link", "JWT", "authentication", "email transporter", "generateMagicLink", "verifyMagicLink"], "state": 2, "file_id": 15, "knowledge_revision": 83, "git_revision": "", "revision_history": [{"31": ""}, {"83": ""}], "ctags": [{"_type": "tag", "name": "AuthService", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^class AuthService {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  constructor() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "createEmailTransporter", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  createEmailTransporter() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "crypto", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^const crypto = require('crypto');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "database", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^const database = require('.\\/database');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      email: user.email$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateJWT.payload", "scopeKind": "class"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^module.exports = new AuthService();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "from", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      from: process.env.EMAIL_FROM || 'noreply@expense-tracker.com',$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "generateJWT", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  generateJWT(user) {$/", "language": "JavaScript", "kind": "method", "signature": "(user)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "generateMagicLink", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  async generateMagicLink(email) {$/", "language": "JavaScript", "kind": "method", "signature": "(email)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "html", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      html: `$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "jwt", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^const jwt = require('jsonwebtoken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "logMagicLinkToConsole", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  logMagicLinkToConsole(email, magicLinkUrl) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, magicLinkUrl)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "mailOptions", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^    const mailOptions = {$/", "language": "JavaScript", "kind": "class", "scope": "AuthService.sendMagicLinkEmail", "scopeKind": "class"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^        message: 'Magic link sent to your email'$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateMagicLink.result", "scopeKind": "class"}, {"_type": "tag", "name": "nodemailer", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^const nodemailer = require('nodemailer');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^    const payload = {$/", "language": "JavaScript", "kind": "class", "scope": "AuthService.generateJWT", "scopeKind": "class"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      const result = {$/", "language": "JavaScript", "kind": "class", "scope": "AuthService.generateMagicLink", "scopeKind": "class"}, {"_type": "tag", "name": "sendMagicLinkEmail", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  async sendMagicLinkEmail(email, magicLinkUrl) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, magicLinkUrl)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "subject", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      subject: 'Your Magic Link - Expense Tracker',$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "success", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^        success: true,$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateMagicLink.result", "scopeKind": "class"}, {"_type": "tag", "name": "to", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      to: email,$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^      userId: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateJWT.payload", "scopeKind": "class"}, {"_type": "tag", "name": "verifyJWT", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  async verifyJWT(token) {$/", "language": "JavaScript", "kind": "method", "signature": "(token)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "verifyMagicLink", "path": "/home/kavia/workspace/code-generation/expense-tracker-dashboard-127432-127441/expense_tracker_backend/src/services/auth.js", "pattern": "/^  async verifyMagicLink(token) {$/", "language": "JavaScript", "kind": "method", "signature": "(token)", "scope": "AuthService", "scopeKind": "class"}], "hash": "8372be8b2f333dad459984a234ef6463", "format-version": 4, "code-base-name": "expense_tracker_backend", "filename": "expense_tracker_backend/src/services/auth.js", "fields": [{"name": "email: user.email", "scope": "AuthService.generateJWT.payload", "scopeKind": "class", "description": "unavailable"}, {"name": "module.exports = new AuthService();", "scope": "module", "scopeKind": "class", "description": "unavailable"}, {"name": "from: process.env.EMAIL_FROM || 'noreply@expense-tracker.com',", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "html: `", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "message: 'Magic link sent to your email'", "scope": "AuthService.generateMagicLink.result", "scopeKind": "class", "description": "unavailable"}, {"name": "subject: 'Your Magic Link - Expense Tracker',", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "success: true,", "scope": "AuthService.generateMagicLink.result", "scopeKind": "class", "description": "unavailable"}, {"name": "to: email,", "scope": "AuthService.sendMagicLinkEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "userId: user.id,", "scope": "AuthService.generateJWT.payload", "scopeKind": "class", "description": "unavailable"}]}